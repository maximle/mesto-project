(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{v:()=>B});var t=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__name"),n=document.querySelector(".profile__calling"),c=document.querySelector(".profile__pic"),r=document.querySelector(".places__list"),a=document.querySelector(".profile__pic-overlay"),u={baseUrl:"https://nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"84bc1fff-03b1-47e2-8e8e-0c12cf25f1f3","Content-Type":"application/json"}};function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function i(e){console.log(e)}var s=[],p=document.querySelector("#place-card").content,d=document.querySelector(".image-popup"),f=document.querySelector(".popup__image"),_=document.querySelector(".popup__image-caption");function m(e,t){var o=p.querySelector(".place").cloneNode(!0),n=o.querySelector(".place__image"),c=o.querySelector(".place__like-count"),r=o.querySelector(".place__delete-button");o.querySelector(".place__name").textContent=e.name,n.alt=e.name,n.src=e.link,c.textContent=e.likes.length,o.id=e._id;var a=o.querySelector(".place__like-button");return e.owner._id===t?r.addEventListener("click",(function(e){var t;console.log(e.target.closest(".place").id),(t=e.target.closest(".place").id,e.target,fetch("".concat(u.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:u.headers}).then(l)).then((function(t){console.log(t),e.target.closest(".place").remove()})).catch((function(e){console.log(e)}))})):r.remove(),e.likes.find((function(e){if(e._id===t)return!0}))&&v(a),a.addEventListener("click",(function(e){var t=e.target.closest(".place");a.classList.contains("place__like-button_active")?function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e.id),{method:"DELETE",headers:u.headers}).then(l)}(t).then((function(e){console.log(e),t.querySelector(".place__like-count").textContent=e.likes.length,a.classList.remove("place__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e.id),{method:"PUT",headers:u.headers}).then(l)}(t).then((function(e){console.log(e),t.querySelector(".place__like-count").textContent=e.likes.length,v(a)})).catch((function(e){console.log(e)}))})),n.addEventListener("click",(function(){f.src=e.link,f.alt=e.name,_.textContent=e.name,E(d)})),o}function v(e){e.classList.add("place__like-button_active")}var y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",disabledButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type-error"},h=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.disabledButtonClass),t.disabled=!1):(t.classList.add(o.disabledButtonClass),t.disabled=!0)};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);h(o,n,t),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),c.textContent=o}(e,t,t.validationMessage,o)}(e,c,t),h(o,n,t)}))}))}(t,e)}))}(y);var S=document.querySelector(".profile-popup"),b=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_calling"),q=document.querySelector(".card-popup").querySelector(".popup__save-button"),L=document.querySelector(".profile-pic-popup");function E(e){e.classList.add("popup_opened"),document.addEventListener("keydown",C)}function k(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",C)}function C(e){"Escape"===e.key&&k(document.querySelector(".popup_opened"))}function x(e,t){t.target.querySelector(".popup__save-button").textContent=e?"Сохранение...":"Сохранить"}var U=document.querySelector(".profile-pic-popup .popup__input_type_calling"),P=document.querySelector(".card-popup"),A=document.querySelector(".profile__add-button"),O=document.querySelector(".card-popup .popup__form"),T=document.querySelector(".card-popup .popup__input_type_name"),w=document.querySelector(".card-popup .popup__input_type_calling");t.addEventListener("click",(function(){b.value=o.textContent,g.value=n.textContent,E(S)})),a.addEventListener("click",(function(){E(L)})),Promise.all([fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then(l),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then(l)]).then((function(e){console.log(e),o.textContent=e[0].name,n.textContent=e[0].about,c.src=e[0].avatar;var t=e[0]._id;e[1].forEach((function(e){s.push(e)})),console.log(s);for(var a=0;a<s.length;a++){var u=m(s[a],t);r.append(u)}})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&k(e),t.target.classList.contains("popup__close-button")&&k(e)}))})),document.querySelector(".popup__form").addEventListener("submit",(function(e){var t,r;e.preventDefault(),x(!0,e),console.log(e.target),(t=b.value,r=g.value,fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:r})}).then(l)).then((function(e){console.log(e),o.textContent=e.name,n.textContent=e.about,c.src=e.avatar,k(S)})).catch(i).finally((function(){x(!1,e)}))}));var B=document.querySelector(".profile-pic-popup .popup__form");B.addEventListener("submit",(function(e){var t;e.preventDefault(),x(!0,e),(t=U.value,fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:t})}).then(l)).then((function(e){console.log(e),c.src=e.avatar,k(L),B.reset()})).catch(i).finally((function(){x(!1,e)}))})),A.addEventListener("click",(function(){E(P)})),O.addEventListener("submit",(function(e){e.preventDefault(),x(!0,e);var t,o={name:T.value,link:w.value};console.log(o),(t=o,fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify(t)}).then(l)).then((function(t){console.log(t),r.prepend(m(t,t.owner._id)),k(P),e.target.classList.contains("popup__input")?e.target.closest(".popup__form").reset():e.target.reset(),q.disabled=!0,q.classList.add(y.disabledButtonClass)})).catch(i).finally((function(){x(!1,e)}))}))})();